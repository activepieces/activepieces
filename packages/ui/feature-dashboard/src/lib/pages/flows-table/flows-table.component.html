<div class="ap-h-[calc(100% - 6.5625rem)] ap-mx-7.5" [class.ap-hidden]="(areThereFlows$|async)===false">
  <div class="ap-flex ap-h-full ">
    <div class=" ap-min-w-[274px] ap-max-w-[274px]" *ngIf="(hideFolders$ | async) === undefined ||(hideFolders$ | async) === false " #foldersSection>
      <div class="ap-typography-headline-5 !ap-font-semibold ap-mb-7.5 ap-mt-20" i18n>My Flows</div>
      <app-folders-list></app-folders-list>
    </div>
    <div class="ap-h-full ap-w-[calc(100%-274px)] ap-pl-[30px] ap-pt-[80px]" [class.ap-w-full]="(hideFolders$ | async)" [class.!ap-pl-0]="(hideFolders$ | async)">
      <div class="ap-h-full ap-mb-[40px]">
        <div
          class=" ap-rounded ap-border ap-border-solid ap-border-dividers ap-p-[30px] ap-pb-[80px] ap-flex ap-flex-col">
          <app-flows-table-title></app-flows-table-title>
          <table mat-table [dataSource]="dataSource" class="ap-w-[100%]" aria-label="Flows" i18n-aria-label>
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef i18n>Name</th>
              <td mat-cell *matCellDef="let flow"><a class="!ap-typography-body-2 !ap-no-underline !ap-text-body"
                  (auxclick)="$event.stopPropagation()" [href]="'/flows/'+flow.id">
                  {{ flow.version.displayName }}
                </a></td>
            </ng-container>
            <ng-container matColumnDef="steps">
              <th mat-header-cell *matHeaderCellDef i18n>Steps</th>
              <td mat-cell *matCellDef="let flow">
                <ap-pieces-icons-from-flow [flowVersion]="flow.version"></ap-pieces-icons-from-flow>
              </td>
            </ng-container>
            <ng-container matColumnDef="created">
              <th mat-header-cell *matHeaderCellDef i18n>Created</th>
              <td mat-cell *matCellDef="let flow">{{ flow.created | date: 'short' }}</td>
            </ng-container>

            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef i18n>Status</th>
              <td mat-cell *matCellDef="let flow">
                <div class="ap-px-1 ap-flex ap-gap-2 ap-items-center">
                  <mat-slide-toggle color="primary" [class.ap-cursor-not-allowed]="flow.instanceToggleControl.disabled"
                    (click)="$event.stopImmediatePropagation(); toggleFlowStatus(flow,flow.instanceToggleControl)"
                    [formControl]="flow.instanceToggleControl"
                    [matTooltip]="flow.instanceToggleControl.value | flowStatus: flow.instanceToggleControl.disabled"></mat-slide-toggle>
                  <div class="ap-min-h-[30px] ap-min-w-[30px] ap-flex ap-items-center ap-justify-center">
                    <svg-icon [src]="flow | triggerIcon"
                      *ngIf="flow.instanceToggleControl.value && !flowsUpdateStatusRequest$[flow.id]"
                      [matTooltip]="flow | triggerTooltip:locale" class="ap-w-[25px] ap-h-[25px] ap-fill-body"
                      [applyClass]="true">
                    </svg-icon>
                    <div *ngIf="flowsUpdateStatusRequest$[flow.id]" class="spinner-border dark-spinner" role="status">
                    </div>
                  </div>

                </div>
              </td>
            </ng-container>

            <ng-container matColumnDef="folderName">
              <th mat-header-cell *matHeaderCellDef i18n>Folder</th>
              <td mat-cell *matCellDef="let flow">{{ flow.folderDisplayName }}</td>
            </ng-container>
            <ng-container matColumnDef="action">
              <th mat-header-cell class="!ap-text-center" *matHeaderCellDef>

              </th>
              <td mat-cell *matCellDef="let flow" class="!ap-text-center">
                <button mat-icon-button (click)="$event.stopImmediatePropagation()" [matMenuTriggerFor]="menu">
                  <mat-icon>more_vert</mat-icon>
                </button>
                <mat-menu #menu="matMenu" xPosition="before">
                  <button mat-menu-item (click)="renameFlow(flow)">
                    <div class="ap-flex ap-gap-3 ap-items-center">
                      <svg-icon [src]="flowActionsUiInfo.rename.icon" [class]="flowActionsUiInfo.iconSizeTailWind"
                        [applyClass]="true"></svg-icon>
                      <span i18n>{{flowActionsUiInfo.rename.text}}</span>
                    </div>
                  </button>
                  <button mat-menu-item (click)="moveFlow(flow)">
                    <div class="ap-flex ap-gap-3 ap-items-center">
                      <svg-icon [src]="flowActionsUiInfo.move.icon" [class]="flowActionsUiInfo.iconSizeTailWind"
                        [applyClass]="true"></svg-icon>
                      <span i18n>{{flowActionsUiInfo.move.text}}</span>
                    </div>
                  </button>
                  <button mat-menu-item (click)="duplicate(flow)">
                    <div class="ap-flex ap-gap-3 ap-items-center">
                      <svg-icon [src]="flowActionsUiInfo.duplicate.icon" [class]="flowActionsUiInfo.iconSizeTailWind"
                        [applyClass]="true"></svg-icon>
                      <span i18n>{{flowActionsUiInfo.duplicate.text}}</span>
                    </div>
                  </button>
                  <button mat-menu-item (click)="export(flow)">
                    <div class="ap-flex ap-gap-3 ap-items-center">
                      <svg-icon [src]="flowActionsUiInfo.export.icon" [class]="flowActionsUiInfo.iconSizeTailWind"
                        [applyClass]="true"></svg-icon>
                      <span i18n>{{flowActionsUiInfo.export.text}}</span>
                    </div>
                  </button>
                  <ap-share-flow-template-dialog [flow]="flow"></ap-share-flow-template-dialog>
                  <app-push-flow-to-git-button [flow]="flow"></app-push-flow-to-git-button>

                  <button (click)="deleteFlow(flow)" mat-menu-item>
                    <div class="ap-flex ap-gap-3 ap-items-center">
                      <svg-icon [src]="flowActionsUiInfo.delete.icon"
                        [class]="'ap-fill-danger '+flowActionsUiInfo.iconSizeTailWind" [applyClass]="true"></svg-icon>
                      <span class="ap-text-danger">{{flowActionsUiInfo.delete.text}}</span>
                    </div>
                  </button>
                </mat-menu>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>

            <tr class="ap-cursor-pointer hover:!ap-bg-hover" (click)="openBuilder(row, $event)"
              (auxclick)="openBuilder(row, $event)" mat-row contextmenu="mymenu"
              [class.ap-hidden]="dataSource.isLoading$ | async" *matRowDef="let row; columns: displayedColumns"></tr>


          </table>
          <ng-container *ngIf="dataSource.data.length===0 && (dataSource.isLoading$ | async) === false">
            <div class="ap-flex ap-items-center ap-justify-center ap-my-8  ap-flex-grow">
              <ng-container *ngIf="showAllFlows$ | async; else folderEmptyMessage">
                <span i18n>You don't have any flows yet</span>
              </ng-container>
              <ng-template #folderEmptyMessage>
                <span i18n>This folder doesn't have any flows yet</span>
              </ng-template>
            </div>
          </ng-container>
          <ng-container *ngIf="(dataSource.isLoading$ | async) === true">
            <div class="ap-flex ap-items-center ap-justify-center ap-flex-grow ap-m-2">
              <ap-loading-icon height="50px" width="51px" [outlineLoader]="true" [whiteLoader]="false">
              </ap-loading-icon>
            </div>
          </ng-container>
        </div>
        <div class="ap-flex ap-justify-end ap-mt-[-73px] ap-pr-[30px]">
          <ap-paginator #paginator> </ap-paginator>
        </div>
      </div>
    </div>
  </div>

</div>

<ng-container *ngIf="(areThereFlows$|async)===false">
  <div class="ap-hidden">
    <app-flows-table-title #actionHandler></app-flows-table-title>
  </div>
  <app-empty-flows-table (openTemplatesDialog)="actionHandler.openTemplatesDialog(true)"></app-empty-flows-table>
</ng-container>


<ng-container *ngIf="deleteFlowDialogClosed$ | async"></ng-container>
<ng-container *ngIf="moveFlowDialogClosed$ | async"></ng-container>
<ng-container *ngFor="let obs$ of flowsUpdateStatusRequest$ | keyvalue">
  <ng-container *ngIf="obs$.value | async"></ng-container>
</ng-container>
<ng-container *ngIf="showAllFlows$ | async"></ng-container>
<ng-container *ngIf="duplicateFlow$ | async"></ng-container>
<ng-container *ngIf="downloadTemplate$ | async"></ng-container>
<ng-container *ngIf="renameFlow$ | async"></ng-container>